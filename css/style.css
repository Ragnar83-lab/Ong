// js/form.js

// Espera o documento carregar para garantir que os elementos existam
document.addEventListener('DOMContentLoaded', function() {
    
    // --- 1. APLICAÇÃO DAS MÁSCARAS ---
    
    const cpfInput = document.getElementById('cpf');
    if (cpfInput) {
        IMask(cpfInput, { mask: '000.000.000-00' });
    }

    const telInput = document.getElementById('telefone');
    if (telInput) {
        IMask(telInput, { mask: '(00) 00000-0000' });
    }

    const cepInput = document.getElementById('cep');
    if (cepInput) {
        IMask(cepInput, { mask: '00000-000' });
    }

    // --- 2. INTERATIVIDADE DA SEÇÃO DE DOAÇÃO ---

    const radioMetodos = document.querySelectorAll('input[name="metodo_doacao"]');
    const detalhesPix = document.getElementById('detalhes-pix');
    const detalhesCartao = document.getElementById('detalhes-cartao');
    const detalhesTransf = document.getElementById('detalhes-transferencia');
    
    function esconderTodosDetalhes() {
        if (detalhesPix) detalhesPix.classList.add('hidden');
        if (detalhesCartao) detalhesCartao.classList.add('hidden');
        if (detalhesTransf) detalhesTransf.classList.add('hidden');
    }

    radioMetodos.forEach(function(radio) {
        radio.addEventListener('change', function() {
            esconderTodosDetalhes();

            if (this.checked) {
                if (this.value === 'pix' && detalhesPix) {
                    detalhesPix.classList.remove('hidden');
                } else if (this.value === 'cartao' && detalhesCartao) {
                    detalhesCartao.classList.remove('hidden');
                } else if (this.value === 'transferencia' && detalhesTransf) {
                    detalhesTransf.classList.remove('hidden');
                }
            }
        });
    });

    // --- 3. PREENCHIMENTO AUTOMÁTICO DE ENDEREÇO (API ViaCEP) ---
    
    if (cepInput) {
        cepInput.addEventListener('blur', function() {
            const cepLimpo = cepInput.value.replace(/\D/g, '');

            if (cepLimpo.length === 8) {
                buscarEndereco(cepLimpo);
            }
        });
    }

    async function buscarEndereco(cep) {
        // Corrigido: URL precisa estar entre aspas e com template string
        const url = const url = `https://viacep.com.br/ws/${cep}/json/`;

        try {
            const response = await fetch(url);
            const data = await response.json();

            if (data.erro) {
                alert('CEP não encontrado. Por favor, verifique e tente novamente.');
                limpar

    function preencherCamposEndereco(data) {
        const enderecoInput = document.getElementById('endereco');
        const cidadeInput = document.getElementById('cidade');
        const estadoInput = document.getElementById('estado');
            preencherCamposEndereco(data);
                } else {
                    alert("Erro ao buscar o endereço. Tente novamente mais tarde.");
                }
            } catch (error) {
                console.error('Erro na requisição:', error);
                alert('Erro ao buscar o endereço. Tente novamente mais tarde.');
            }CamposEndereco();
                return;
            }
        if (enderecoInput) enderecoInput.value = data.logradouro || '';
        if (cidadeInput) cidadeInput.value = data.localidade || '';
        if (estadoInput) estadoInput.value = data.uf || '';
    }

    function limparCamposEndereco() {
        const enderecoInput = document.getElementById('endereco');
        const cidadeInput = document.getElementById('cidade');
        const estadoInput = document.getElementById('estado');

        if (enderecoInput) enderecoInput.value = '';
        if (cidadeInput) cidadeInput.value = '';
        if (estadoInput) estadoInput.value = '';
    }

});